<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="description" content="Sesol-2 Story Points Estimator">
    <meta property="og:title" content="Sesol-2 Story Points Estimator"/><!-- 35 -->
    <meta property="og:url" content="https://acdcjunior.github.io/estimator/"/>
    <meta property="og:description" content="Sesol-2 Story Points Estimator"><!-- 65 -->
    <meta property="og:image" content="https://acdcjunior.github.io/estimator/icon.png">
    <meta property="og:type" content="website"/>
    <meta property="og:locale" content="pt_BR"/>

    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">

    <link rel="icon" type="image/x-icon" href="icon.png">
    <meta name="theme-color" content="#17a2b8">

    <title>Sesol-2 Story Points Estimator</title>
</head>
<body>

<script src="https://unpkg.com/vue"></script>
<link type="text/css" rel="stylesheet" href="//unpkg.com/bootstrap/dist/css/bootstrap.min.css"/>
<link type="text/css" rel="stylesheet" href="//unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.css"/>
<script src="//unpkg.com/babel-polyfill@latest/dist/polyfill.min.js"></script>
<script src="//unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.js"></script>

<style>
    .form-group {
        margin-bottom: 2px;
    }

    .peso-individual {
        display: inline-block;
        width: 30px;
        padding-right: 1px;
        font-weight: bold;
        text-align: center;
        border: 2px solid black;
        border-radius: 15px;
        height: 28px;
        line-height: 22px;
        margin-top: 3px;
    }

    /*@media (max-width: 600px) {*/
    div.estimativa {
        top: 0.3em;
        left: 0.3em;
        width: 80px;
        height: 80px;
        line-height: 79px;
    }

    div.estimativa.reset-open {
        width: 300px;
        height: 83px;
    }

    /*}*/
    @media (min-width: 600px) {
        .btn.btn-variavel {
            padding: .25rem .5rem;
            font-size: .875rem;
            line-height: 1.5;
            border-radius: .2rem;
        }
    }

    .estimativa {
        transition: all 300ms ease;
        user-select: none;
        cursor: pointer;
        width: 37px;
        height: 37px;
        border-radius: 50%;
        font-size: xx-large;
        color: #fff;
        line-height: 36px;
        text-align: center;
        background: #000;
        position: fixed;
        top: 0.3em;
        left: 0.3em;
        z-index: 999;
    }

    .estimativa.reset-open {
        width: 300px;
        height: 40px;
        border-radius: 10px;
    }

    .reset-buttons-open {
        height: 40px;
    }

    .bounce-enter-active {
        animation: bounce-in .5s;
    }

    .bounce-leave-active {
        animation: bounce-in .0s reverse;
    }

    @keyframes bounce-in {
        0% {
            transform: scale(0);
        }
        50% {
            transform: scale(1.5);
        }
        100% {
            transform: scale(1);
        }
    }

    .exata {
        display: inline-block;
        position: absolute;
        top: 27px;
        right: 0;
        font-size: 50%;
        text-align: center;
        width: 80px;
        color: #8e8e8e;
    }
</style>

<div id="app">
    <div class="estimativa" @click="abrirResetPanel" :class="{'reset-open': reset_flag, 'bounce-enter-active': bounce_estimativa_flag}">
        {{ peso }}
        <span class="exata" v-if="estimativa && peso !== estimativa">{{ estimativa }}</span>
        <transition name="bounce">
            <div v-if="reset_flag" style="display: inline-block">
                &nbsp; Reiniciar?
                <b-btn size="sm" @click="resetar">Sim</b-btn>
                <b-btn>Não</b-btn>
            </div>
        </transition>
    </div>
    <br><br>
    <div v-for="comp of componentes" @click="reset_flag = false">
        <b-card no-body class="mb-1">
            <b-card-header header-tag="header" class="p-1" role="tab">
                <b-btn block variant="info" @click="comp.show = !comp.show">{{ comp.titulo }}</b-btn>
            </b-card-header>
            <b-collapse v-model="comp.show" id="comp.titulo">
                <b-card-body>

                    <b-list-group class="card-text">
                        <b-list-group-item v-for="parte of comp.partes">
                            <span style="display: inline-block; width: 250px">{{ parte.titulo }}</span>

                            <b-form-group style="display: inline-block">
                                <b-form-radio-group
                                        buttons :options="options_tipo_edicao" size="variavel"
                                        button-variant="outline-success"
                                        v-model="parte.valor_edicao"
                                />
                            </b-form-group>
                            <b-form-group style="display: inline-block" v-show="parte.valor_edicao">
                                <b-form-radio-group
                                        buttons :options="options_tipo_conhecimento" size="variavel"
                                        button-variant="outline-primary"
                                        v-model="parte.valor_conhecimento"
                                />
                            </b-form-group>
                            <span v-if="parte.valor_edicao">
                  <span class="peso-individual">{{ (parte.valor_edicao || 0) * (parte.valor_conhecimento || 1) || '' }}</span>
                  <b-button variant="danger" size="sm" @click="clear(parte)">×</b-button>
                </span>

                        </b-list-group-item>
                    </b-list-group>

                </b-card-body>
            </b-collapse>
        </b-card>
    </div>
</div>


<script>
    new Vue({
        el: '#app',
        data: {
            // 0,   1  2  3  4  5  6  7  8,  9, 10, 11, 12, 13, 14+ = 20
            pesos: [0.5, 1, 2, 3, 5, 5, 8, 8, 8, 10, 10, 13, 13, 13],
            reset_flag: false,
            bounce_estimativa_flag: false,
            options_tipo_edicao: [
                {text: 'Editar Existente', value: 1}, {text: 'Criar Novo', value: 3}
            ],
            options_tipo_conhecimento: [
                {text: 'Conhecido', value: 1}, {text: 'Desconhecido', value: 2}, {text: 'Desafio', value: 4}
            ],
            componentes: [
                {
                    titulo: 'Camada de Apresentação JSF',
                    partes: [
                        {titulo: 'XHTML de tela principal'},
                        {titulo: 'XHTML de coluna'},
                        {titulo: 'Vue (em XHTML)'},
                        {titulo: 'MBean'},
                        {titulo: 'Bean'},
                        {titulo: 'Fábrica de Bean'},
                    ]
                },
                {
                    titulo: 'Vue',
                    partes: [
                        {titulo: 'Componente Vue'},
                        {titulo: 'Vuex'},
                        {titulo: 'Configurar Router'},
                        {titulo: 'Outro'}
                    ]
                },
                {
                    titulo: 'Camada de Apresentação REST',
                    partes: [
                        {titulo: 'Controller'}
                    ]
                },
                {
                    titulo: 'Camada de Aplicação',
                    partes: [
                        {titulo: 'Serviço de Aplicação'},
                        {titulo: 'Item'},
                        {titulo: 'Coluna'},
                        {titulo: 'Fábrica de Item'},
                        {titulo: 'Fábrica de Coluna'}
                    ]
                },
                {
                    titulo: 'Camada de Negócio',
                    partes: [
                        {titulo: 'Entidade'},
                        {titulo: 'Serviço de Negócio'},
                        {titulo: 'Regra'},
                        {titulo: 'Pré/Pós Validador'},
                        {titulo: 'E-mail (com Observador)'},
                        {titulo: 'Repositório'},
                        {titulo: 'Serviço/Repositório REST Externo'}
                    ]
                },
                {
                    titulo: 'Scripts',
                    partes: [
                        {titulo: 'e-Gestao'},
                        {titulo: 'Funcao Computacional'}
                    ]
                },
                {
                    titulo: 'Infraestrutura',
                    partes: [
                        {titulo: 'Atualizar Versões de Bibliotecas'},
                        {titulo: 'Configurar Jenkins'},
                        {titulo: 'Configurar Sonar'},
                        {titulo: 'Novo Repositório'},
                        {titulo: 'Novo Owner de Banco'},
                        {titulo: 'Novo Recurso Computacional/Usuário de Sistema'},
                        {titulo: 'Outras Configurações'},
                    ]
                }
            ]
        },
        mounted() {
            this.resetar();
            for (let i = 14; i <= 20; i++) this.pesos[i] = 20;
            for (let i = 21; i <= 40; i++) this.pesos[i] = 40;
            for (let i = 41; i <= 999; i++) this.pesos[i] = '∞';
        },
        methods: {
            clear(parte) {
                parte.valor_edicao = 0;
                parte.valor_conhecimento = 1;
            },
            resetar() {
                this.componentes.forEach(comp => {
                    Vue.set(comp, 'show', false);
                    comp.partes.forEach(parte => {
                        Vue.set(parte, 'valor_edicao', null);
                        Vue.set(parte, 'valor_conhecimento', 1);
                    })
                });
            },
            abrirResetPanel() {
                this.reset_flag = !this.reset_flag;
                //this.resetar();
            }
        },
        computed: {
            estimativa() {
                return this.componentes.reduce((sum, comp) => {
                    return sum + comp.partes.reduce((sum, parte) => {
                        if (parte.valor_edicao && parte.valor_conhecimento)
                            return sum + (parte.valor_edicao || 0) * (parte.valor_conhecimento || 1);
                        else
                            return sum;
                    }, 0);
                }, 0);
            },
            peso() {
                return this.pesos[this.estimativa];
            }
        },
        watch: {
            peso() {
                this.bounce_estimativa_flag = true;
                setTimeout(() => {
                    this.bounce_estimativa_flag = false;
                }, 500);
            }
        }
    })
</script>

</body>
</html>
